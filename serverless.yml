	
# serverless.yml
 
service: fruit-project-api-scraper
frameworkVersion: '3'

plugins:
  - serverless-prune-plugin
 
params:
  default:
    table1: 'fruit'
    table2: 'cocktail-recipes'
    table3: 'food-recipes'

provider:
  name: aws
  runtime: python3.10
  region: eu-west-2
  runtimeManagement: auto
  memorySize: 512
  timeout: 10
  environment:
    APP: "fruit-project-api-scraper"
    SOURCE_API_NAME: "fruity-vice"



# ecr:
# images:
#   fruit-project-api-scraper:
#     path: ./

functions:
  fruit-project-api-scraper:
    image: ${AWS::AccountId}.dkr.ecr.${AWS::Region}.amazonaws.com/${env.APP}:latest
iam:
  role:
    name: ${env:APP}-lambda-role
    statements:
      - Effect: "Allow"
        Action:
        - dynamodb:DescribeTable
        - dynamodb:Query
        - dynamodb:Scan
        - dynamodb:GetItem
        - dynamodb:PutItem
        - dynamodb:UpdateItem
        - dynamodb:DeleteItem
        Resource: 
          - Fn::Sub: arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:${param:table1}
          - Fn::Sub: arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:${param:table2}
          - Fn::Sub: arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:${param:table3}

custom:
  prune:
    automatic: true
    number: 3
